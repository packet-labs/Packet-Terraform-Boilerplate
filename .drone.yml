kind: pipeline
name: default

steps:
  
- name: Deploy
  image: alpine
  environment:
    TF_VAR_auth_token: TF_VAR_auth_token
    TF_VAR_packet_project_id: TF_VAR_packet_project_id
  commands:
  - apk update
  - apk add openssh-client
  - apk add terraform
  - ln -s terraform.tfvars.drone terraform.tfvars 
  - terraform init 
  - terraform validate -var-files="terraform.tfvars.drone"
  - terraform apply -var-files="terraform.tfvars.drone" -auto-approve
  - terraform destroy -var-files="terraform.tfvars.drone" -auto-approve
